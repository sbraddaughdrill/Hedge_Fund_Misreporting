data_s1_bins_full[,"kink_percent_75"] <- ifelse(data_s1_bins_full[,"kink_ratio"]<=0.75,1,0)
data_s1_bins_full[,"kink_percent_66"] <- ifelse(data_s1_bins_full[,"kink_ratio"]<=0.66,1,0)
data_s1_bins_full[,"kink_percent_50"] <- ifelse(data_s1_bins_full[,"kink_ratio"]<=0.50,1,0)
data_s1_final <- data_s1_bins_full[,c(identifier,"kink_percent_99","kink_percent_95","kink_percent_90","kink_percent_75","kink_percent_66","kink_percent_50")]
rm2(data_s1_bins_full)
rm2(data_s1)
View(data_s1_final)
x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
analysis_col <- analysis_col
id_col <- identifier
data <- x
ret_col <- analysis_col
View(data)
repeat_num_data_trim <- data[!is.na(data[,ret_col]),]
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
View(repeat_num_data_count)
View(repeat_num_data_count)
ret <- data[,ret_col]
repeat_num_data_trim <- ret[!is.na(ret[,ret_col])]
ret <- data[,ret_col]
repeat_num_data_trim <- ret[!is.na(ret]
ret <- data[,ret_col]
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_count <- ldply(.data=repeat_num_data_trim, .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(x,repeat_num_data_trim,stringsAsFactors=FALSE))
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
ret <- data[,ret_col]
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(x,repeat_num_data_trim,stringsAsFactors=FALSE)
ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(x,repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(x,repeat_num_data_trim,stringsAsFactors=FALSE)
ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
colnames(repeat_num_data_trim) <- ret_col
View(repeat_num_data_trim)
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
repeat_num_data_count <- repeat_num_data_count[order(repeat_num_data_count[,"fund_id"], repeat_num_data_count[,"Freq"]),]
row.names(repeat_num_data_count) <- seq(nrow(repeat_num_data_count))
ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
colnames(repeat_num_data_trim) <- ret_col
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
repeat_num_data_count <- repeat_num_data_count[order(repeat_num_data_count[,"Freq"]),]
row.names(repeat_num_data_count) <- seq(nrow(repeat_num_data_count))
ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
colnames(repeat_num_data_trim) <- ret_col
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
repeat_num_data_count <- repeat_num_data_count[order(repeat_num_data_count[,"Freq"]),]
row.names(repeat_num_data_count) <- seq(nrow(repeat_num_data_count))
View(repeat_num_data_trim)
View(repeat_num_data_count)
num_repeat_screen_counts <- function(ret,ret_col){
require(plyr)
# ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
colnames(repeat_num_data_trim) <- ret_col
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
repeat_num_data_count <- repeat_num_data_count[order(repeat_num_data_count[,"Freq"]),]
row.names(repeat_num_data_count) <- seq(nrow(repeat_num_data_count))
return(repeat_num_data_count)
}
num_repeat_screen_counts(data=data[,ret_col])
repeat_num_data_count <- num_repeat_screen_counts(data=data[,ret_col],ret_col=ret_col)
repeat_num_data_count <- num_repeat_screen_counts(ret=data[,ret_col],ret_col=ret_col)
View(repeat_num_data_count)
data <- repeat_num_data_count
data <- repeat_num_data_count
sum_temp <- data.frame(tail(data,1),Count_u=NA,Total=NA,Prop_u=NA,stringsAsFactors=FALSE)
sum_temp[,"Count_u"] <- nrow(data)
sum_temp[,"Total"] <- sum(data[,data_col])
sum_temp[,"Prop_u"] <- sum_temp[,"Count_u"]/sum_temp[,"Total"]
data_col <- "Freq"
sum_temp <- data.frame(tail(data,1),Count_u=NA,Total=NA,Prop_u=NA,stringsAsFactors=FALSE)
sum_temp[,"Count_u"] <- nrow(data)
sum_temp[,"Total"] <- sum(data[,data_col])
sum_temp[,"Prop_u"] <- sum_temp[,"Count_u"]/sum_temp[,"Total"]
View(sum_temp)
View(repeat_num_data_count)
tail(data,1)
View(sum_temp)
View(sum_temp)
data <- repeat_num_data_count
# data_col <- "Freq"
sum_temp <- data.frame(Count_u=NA,Total=NA,Prop_u=NA,stringsAsFactors=FALSE)
sum_temp[,"Count_u"] <- nrow(data)
sum_temp[,"Total"] <- sum(data[,data_col])
sum_temp[,"Prop_u"] <- sum_temp[,"Count_u"]/sum_temp[,"Total"]
View(sum_temp)
num_repeat_screen_counts <- function(ret,ret_col){
require(plyr)
# ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
colnames(repeat_num_data_trim) <- ret_col
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
repeat_num_data_count <- repeat_num_data_count[order(repeat_num_data_count[,"Freq"]),]
row.names(repeat_num_data_count) <- seq(nrow(repeat_num_data_count))
return(repeat_num_data_count)
}
num_repeat_screen_sum <- function(data,data_col){
# data <- repeat_num_data_count
# data_col <- "Freq"
sum_temp <- data.frame(Count_u=NA,Total=NA,Prop_u=NA,stringsAsFactors=FALSE)
sum_temp[,"Count_u"] <- nrow(data)
sum_temp[,"Total"] <- sum(data[,data_col])
sum_temp[,"Prop_u"] <- sum_temp[,"Count_u"]/sum_temp[,"Total"]
return(repeat_num_data_sum)
}
num_repeat_screen_execute <- function(data,ret_col){
# data <- x
# ret_col <- analysis_col
repeat_num_data_count <- num_repeat_screen_counts(ret=data[,ret_col],ret_col=ret_col)
repeat_num_data_sum <- num_repeat_screen_sum(data=repeat_num_data_count,data_col="Freq")
rm(repeat_num_data_count)
return(repeat_num_data_sum)
}
data_s5_2_screen <- ddply(.data=data_s5[c(data_trim_id_full_cols,analysis_col)], .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
# analysis_col <- analysis_col
# id_col <- identifier
num_repeat_screen <- num_repeat_screen_execute(data=x,ret_col=analysis_col)
return(num_repeat_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
num_repeat_screen_counts <- function(ret,ret_col){
require(plyr)
# ret <- data[,ret_col]
# ret_col <- ret_col
repeat_num_data_trim <- ret[!is.na(ret)]
repeat_num_data_trim <- as.data.frame(repeat_num_data_trim,stringsAsFactors=FALSE)
row.names(repeat_num_data_trim) <- seq(nrow(repeat_num_data_trim))
colnames(repeat_num_data_trim) <- ret_col
repeat_num_data_count <- ddply(.data=repeat_num_data_trim, .variables=c(ret_col), .fun = function(x){
# x <- repeat_num_data_trim[repeat_num_data_trim[,"fund_id"]==0,]
count_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(count_temp)
},.progress = "none")
repeat_num_data_count <- repeat_num_data_count[order(repeat_num_data_count[,"Freq"]),]
row.names(repeat_num_data_count) <- seq(nrow(repeat_num_data_count))
return(repeat_num_data_count)
}
num_repeat_screen_sum <- function(data,data_col){
# data <- repeat_num_data_count
# data_col <- "Freq"
sum_temp <- data.frame(Count_u=NA,Total=NA,Prop_u=NA,stringsAsFactors=FALSE)
sum_temp[,"Count_u"] <- nrow(data)
sum_temp[,"Total"] <- sum(data[,data_col])
sum_temp[,"Prop_u"] <- sum_temp[,"Count_u"]/sum_temp[,"Total"]
return(sum_temp)
}
num_repeat_screen_execute <- function(data,ret_col){
# data <- x
# ret_col <- analysis_col
repeat_num_data_count <- num_repeat_screen_counts(ret=data[,ret_col],ret_col=ret_col)
repeat_num_data_sum <- num_repeat_screen_sum(data=repeat_num_data_count,data_col="Freq")
rm(repeat_num_data_count)
return(repeat_num_data_sum)
}
data_s5_2_screen <- ddply(.data=data_s5[c(data_trim_id_full_cols,analysis_col)], .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
# analysis_col <- analysis_col
# id_col <- identifier
num_repeat_screen <- num_repeat_screen_execute(data=x,ret_col=analysis_col)
return(num_repeat_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
View(data_s5_2_screen)
x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
data <- x
ret_col <- analysis_col
rle_temp <- data.frame(do.call(cbind,rle(data[,ret_col])),stringsAsFactors=FALSE)
rle_temp <- rle_temp[,c("values","lengths")]
View(rle_temp)
rle_sum <- data.frame(unique(rle_temp[,c("lengths")]),stringsAsFactors=FALSE)
View(rle_sum)
rle_sum <- data.frame(lengths=unique(rle_temp[,c("lengths")]),stringsAsFactors=FALSE)
rle_temp <- data.frame(do.call(cbind,rle(data[,ret_col])),stringsAsFactors=FALSE)
rle_temp <- rle_temp[,c("values","lengths")]
rle_sum <- data.frame(lengths=unique(rle_temp[,c("lengths")]),stringsAsFactors=FALSE)
rle_sum <- rle_sum[order(rle_sum[,"lengths"]),]
row.names(rle_sum) <- seq(nrow(rle_sum))
rle_sum <- data.frame(lengths=sort(unique(rle_temp[,c("lengths")])),stringsAsFactors=FALSE)
View(rle_sum)
rle_max <- data.frame(tail(rle_sum,1),stringsAsFactors=FALSE)
View(rle_max)
View(data_s5_2_screen)
string_screen_temp <- string_screen_rle(data=data,ret_col=ret_col)
string_screen_rle <- function(data,ret_col){
# data <- data
# ret_col <- ret_col
rle_temp <- data.frame(do.call(cbind,rle(data[,ret_col])),stringsAsFactors=FALSE)
rle_temp <- rle_temp[,c("values","lengths")]
return(data.frame(lengths=sort(unique(rle_temp[,c("lengths")])),stringsAsFactors=FALSE))
}
string_screen_temp <- string_screen_rle(data=data,ret_col=ret_col)
View(string_screen_temp)
string_screen_execute <- function(data,ret_col){
# data <- x
# ret_col <- analysis_col
string_screen_temp <- string_screen_rle(data=data,ret_col=ret_col)
return(tail(string_screen_temp,1))
}
string_screen <- string_screen_execute(data=x,ret_col=analysis_col)
View(string_screen)
data_s5_3_screen <- ddply(.data=data_s5[c(data_trim_id_full_cols,analysis_col)], .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
# analysis_col <- analysis_col
# id_col <- identifier
string_screen <- string_screen_execute(data=x,ret_col=analysis_col)
return(string_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
View(data_s5_3_screen)
string_screen_counts <- string_screen_rle(data=data,ret_col=ret_col)
string_screen_temp <- data.frame(tail(string_screen_counts,1),Count_u=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
View(string_screen_temp)
data <- x
# ret_col <- analysis_col
string_screen_counts <- string_screen_rle(data=data,ret_col=ret_col)
string_screen_temp <- data.frame(Max_Length=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
string_screen_temp[,"Max_Length"] <- tail(string_screen_counts,1)
string_screen_temp[,"Total"] <- nrow(data)
string_screen_temp[,"Prop_u"] <- string_screen_temp[,"Max_Length"]/string_screen_temp[,"Total"]
View(string_screen_temp)
data_s5_3_screen <- ddply(.data=data_s5[c(data_trim_id_full_cols,analysis_col)], .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
# analysis_col <- analysis_col
# id_col <- identifier
string_screen <- string_screen_execute(data=x,ret_col=analysis_col)
return(string_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
View(data_s5_3_screen)
string_screen_execute <- function(data,ret_col){
# data <- x
# ret_col <- analysis_col
string_screen_counts <- string_screen_rle(data=data,ret_col=ret_col)
string_screen_temp <- data.frame(Max_Length=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
string_screen_temp[,"Max_Length"] <- tail(string_screen_counts,1)
string_screen_temp[,"Total"] <- nrow(data)
string_screen_temp[,"Prop_u"] <- string_screen_temp[,"Max_Length"]/string_screen_temp[,"Total"]
return(string_screen_temp)
}
data_s5_3_screen <- ddply(.data=data_s5[c(data_trim_id_full_cols,analysis_col)], .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
# analysis_col <- analysis_col
# id_col <- identifier
string_screen <- string_screen_execute(data=x,ret_col=analysis_col)
return(string_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
View(data_s5_3_screen)
string_screen_rle <- function(data,ret_col){
# data <- data
# ret_col <- ret_col
rle_temp <- data.frame(do.call(cbind,rle(data[,ret_col])),stringsAsFactors=FALSE)
rle_temp <- rle_temp[,c("values","lengths")]
return(data.frame(lengths=sort(unique(rle_temp[,c("lengths")])),stringsAsFactors=FALSE))
}
string_screen_execute <- function(data,ret_col){
# data <- x
# ret_col <- analysis_col
string_screen_counts <- string_screen_rle(data=data,ret_col=ret_col)
string_screen_temp <- data.frame(Max_Length=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
string_screen_temp[,"Max_Length"] <- tail(string_screen_counts,1)
string_screen_temp[,"Total"] <- nrow(data)
string_screen_temp[,"Prop_u"] <- string_screen_temp[,"Max_Length"]/string_screen_temp[,"Total"]
return(string_screen_temp)
}
data_s5_3_screen <- ddply(.data=data_s5[c(data_trim_id_full_cols,analysis_col)], .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0, c(data_trim_id_full_cols,analysis_col)]
# analysis_col <- analysis_col
# id_col <- identifier
string_screen <- string_screen_execute(data=x,ret_col=analysis_col)
return(string_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
### Create Flags
data_s5_3_full <- data.frame(data_s5_3_screen,cutoff=NA,
string_percent_99=NA,string_percent_95=NA,string_percent_90=NA,
stringsAsFactors=FALSE)
rm(data_s5_3_screen)
data_s5_3_full[,"string_percent_99"] <- ifelse(data_s5_3_full[,"Prop_u"]<=0.01,1,0)
data_s5_3_full[,"string_percent_95"] <- ifelse(data_s5_3_full[,"Prop_u"]<=0.05,1,0)
data_s5_3_full[,"string_percent_90"] <- ifelse(data_s5_3_full[,"Prop_u"]<=0.10,1,0)
data_s5_3_final <- data_s5_3_full[,c(identifier,"string_percent_99","string_percent_95","string_percent_90")]
rm2(data_s5_3_full)
x <- data_s5[data_s5[,identifier]==0,]
data <- x
ret_col <- analysis_col
View(data)
ret_col <- analysis_col
lag_ret_col <- paste(analysis_col,"lag1",sep="_")
num_pair_data_trim <- data[!(is.na(data[,ret_col]) | is.na(data[,lag_ret_col])),]
row.names(num_pair_data_trim) <- seq(nrow(num_pair_data_trim))
View(num_pair_data_trim)
View(data)
num_pair_data <- data.frame(data[,c(ret_col,lag_ret_col)]Repeat=NA,Pair=NA,stringsAsFactors=FALSE)
num_pair_data <- data.frame(data[,c(ret_col,lag_ret_col)],Repeat=NA,Pair=NA,stringsAsFactors=FALSE)
View(num_pair_data)
num_pair_data_trim <- data[!(is.na(num_pair_data[,ret_col]) | is.na(num_pair_data[,lag_ret_col])),]
row.names(num_pair_data_trim) <- seq(nrow(num_pair_data_trim))
View(num_pair_data_trim)
num_pair_data <- data.frame(data[,c(ret_col,lag_ret_col)],Repeat=NA,Pair=NA,stringsAsFactors=FALSE)
num_pair_data_trim <- num_pair_data[!(is.na(num_pair_data[,ret_col]) | is.na(num_pair_data[,lag_ret_col])),]
row.names(num_pair_data_trim) <- seq(nrow(num_pair_data_trim))
num_pair_data <- data.frame(data[,c(ret_col,lag_ret_col)],Repeat=NA,Pair=NA,stringsAsFactors=FALSE)
num_pair_data_trim <- num_pair_data[!(is.na(num_pair_data[,ret_col]) | is.na(num_pair_data[,lag_ret_col])),]
row.names(num_pair_data_trim) <- seq(nrow(num_pair_data_trim))
num_pair_data_trim[,"Repeat"] <- ifelse(num_pair_data_trim[,ret_col]==num_pair_data_trim[,lag_ret_col],1,0)
num_pair_data_trim[,"Pair"] <- paste(formatC(num_pair_data_trim[,ret_col], digits = 4, format = "f", flag = "0"),
formatC(num_pair_data_trim[,lag_ret_col], digits = 4, format = "f", flag = "0"),sep="_")
num_pair_data_trim[,"Pair"] <- ifelse(num_pair_data_trim[,"Repeat"]==1,NA,num_pair_data_trim[,"Pair"])
num_pair_data_trim2 <- num_pair_data_trim[!is.na(num_pair_data_trim[,"Pair"]),]
row.names(num_pair_data_trim2) <- seq(nrow(num_pair_data_trim2))
View(num_pair_data_trim2)
num_pairs_screen_pairs <- function(data,ret_col,lag_ret_col){
# data <- data
# ret_col <- ret_col
# lag_ret_col <- lag_ret_col
num_pair_data <- data.frame(data[,c(ret_col,lag_ret_col)],Repeat=NA,Pair=NA,stringsAsFactors=FALSE)
num_pair_data_trim <- num_pair_data[!(is.na(num_pair_data[,ret_col]) | is.na(num_pair_data[,lag_ret_col])),]
row.names(num_pair_data_trim) <- seq(nrow(num_pair_data_trim))
rm(num_pair_data)
num_pair_data_trim[,"Repeat"] <- ifelse(num_pair_data_trim[,ret_col]==num_pair_data_trim[,lag_ret_col],1,0)
num_pair_data_trim[,"Pair"] <- paste(formatC(num_pair_data_trim[,ret_col], digits = 4, format = "f", flag = "0"),
formatC(num_pair_data_trim[,lag_ret_col], digits = 4, format = "f", flag = "0"),sep="_")
num_pair_data_trim[,"Pair"] <- ifelse(num_pair_data_trim[,"Repeat"]==1,NA,num_pair_data_trim[,"Pair"])
num_pair_data_trim2 <- num_pair_data_trim[!is.na(num_pair_data_trim[,"Pair"]),]
row.names(num_pair_data_trim2) <- seq(nrow(num_pair_data_trim2))
rm(num_pair_data_trim)
return(num_pair_data_trim2)
}
num_pair_data <- num_pairs_screen_pairs(data=data,ret_col=ret_col,lag_ret_col=lag_ret_col)
View(num_pair_data)
pairs <- num_pair_data
num_pair_data_sum <- ddply(.data=pairs[,c("Pair")], .variables=c("Pair"), .fun = function(x){
# x <- pairs[pairs[,"fund_id"]==0,c("fund_id","Pair")]
counts_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(counts_temp)
},.progress = "none")
x <- pairs[,c("Pair")]
counts_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
counts_temp <- unique(data.frame(x,Freq=length(x),stringsAsFactors=FALSE))
num_pair_data_sum <- ddply(.data=pairs[,c("Pair")], .variables=c("Pair"), .fun = function(x){
# x <- pairs[,c("Pair")]
counts_temp <- unique(data.frame(x,Freq=length(x),stringsAsFactors=FALSE))
return(counts_temp)
},.progress = "none")
View(pairs)
pairs_trim <- pairs[,c("Pair")]
View(pairs)
pairs_trim <- pairs[,c("Pair")]
pairs_trim <- as.data.frame(pairs_trim,stringsAsFactors=FALSE)
colnames(pairs_trim) <- pair_col
pair_col <- "Pair"
pairs_trim <- pairs[,c("Pair")]
pairs_trim <- as.data.frame(pairs_trim,stringsAsFactors=FALSE)
colnames(pairs_trim) <- pair_col
num_pair_data_sum <- ddply(.data=, .variables=c("Pair"), .fun = function(x){
# x <- pairs[,c("Pair")]
counts_temp <- unique(data.frame(x,Freq=length(x),stringsAsFactors=FALSE))
return(counts_temp)
},.progress = "none")
pairs_trim <- pairs[,c("Pair")]
pairs_trim <- as.data.frame(pairs_trim,stringsAsFactors=FALSE)
colnames(pairs_trim) <- pair_col
num_pair_data_sum <- ddply(.data=pairs_trim, .variables=pair_col, .fun = function(x){
# x <- pairs[,c("Pair")]
counts_temp <- unique(data.frame(x,Freq=length(x),stringsAsFactors=FALSE))
return(counts_temp)
},.progress = "none")
num_pair_data_sum <- ddply(.data=pairs_trim, .variables=pair_col, .fun = function(x){
# x <- pairs[,c("Pair")]
counts_temp <- unique(data.frame(x,Freq=nrow(x),stringsAsFactors=FALSE))
return(counts_temp)
},.progress = "none")
num_pair_data_sum <- count(pairs_trim,pair_col)
View(num_pair_data_sum)
View(num_pair_data_sum)
num_pair_data_sum <- num_pair_data_sum[order(num_pair_data_sum[,"freq"]),]
row.names(num_pair_data_sum) <- seq(nrow(num_pair_data_sum))
View(num_pair_data_sum)
num_pairs_screen_counts <- function(pairs,pair_col){
require(plyr)
# pairs <- num_pair_data
# pair_col <- "Pair"
pairs_trim <- pairs[,c("Pair")]
pairs_trim <- as.data.frame(pairs_trim,stringsAsFactors=FALSE)
colnames(pairs_trim) <- pair_col
num_pair_data_sum <- count(pairs_trim,pair_col)
num_pair_data_sum <- num_pair_data_sum[order(num_pair_data_sum[,"freq"]),]
row.names(num_pair_data_sum) <- seq(nrow(num_pair_data_sum))
return(num_pair_data_sum)
}
num_pairs_counts <- num_pairs_screen_counts(pairs=num_pair_data,pair_col="Pair")
View(num_pairs_counts)
num_pairs_screen_temp <- data.frame(Max_Pairs=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
View(num_pairs_counts)
num_pairs_screen_temp[,"Max_Length"] <- tail(num_pairs_counts[,"freq"],1)
num_pair_data <- num_pairs_screen_pairs(data=data,ret_col=ret_col,lag_ret_col=lag_ret_col)
num_pairs_counts <- num_pairs_screen_counts(pairs=num_pair_data,pair_col="Pair")
num_pairs_screen_temp <- data.frame(Max_Pairs=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
num_pairs_screen_temp[,"Max_Pairs"] <- tail(num_pairs_counts[,"freq"],1)
num_pairs_screen_temp[,"Total"] <- nrow(data)
num_pairs_screen_temp[,"Prop_u"] <- num_pairs_screen_temp[,"Max_Pairs"]/num_pairs_screen_temp[,"Total"]
View(num_pairs_screen_temp)
num_pairs_screen_pairs <- function(data,ret_col,lag_ret_col){
# data <- data
# ret_col <- ret_col
# lag_ret_col <- lag_ret_col
num_pair_data <- data.frame(data[,c(ret_col,lag_ret_col)],Repeat=NA,Pair=NA,stringsAsFactors=FALSE)
num_pair_data_trim <- num_pair_data[!(is.na(num_pair_data[,ret_col]) | is.na(num_pair_data[,lag_ret_col])),]
row.names(num_pair_data_trim) <- seq(nrow(num_pair_data_trim))
rm(num_pair_data)
num_pair_data_trim[,"Repeat"] <- ifelse(num_pair_data_trim[,ret_col]==num_pair_data_trim[,lag_ret_col],1,0)
num_pair_data_trim[,"Pair"] <- paste(formatC(num_pair_data_trim[,ret_col], digits = 4, format = "f", flag = "0"),
formatC(num_pair_data_trim[,lag_ret_col], digits = 4, format = "f", flag = "0"),sep="_")
num_pair_data_trim[,"Pair"] <- ifelse(num_pair_data_trim[,"Repeat"]==1,NA,num_pair_data_trim[,"Pair"])
num_pair_data_trim2 <- num_pair_data_trim[!is.na(num_pair_data_trim[,"Pair"]),]
row.names(num_pair_data_trim2) <- seq(nrow(num_pair_data_trim2))
rm(num_pair_data_trim)
return(num_pair_data_trim2)
}
num_pairs_screen_counts <- function(pairs,pair_col){
require(plyr)
# pairs <- num_pair_data
# pair_col <- "Pair"
pairs_trim <- pairs[,c("Pair")]
pairs_trim <- as.data.frame(pairs_trim,stringsAsFactors=FALSE)
colnames(pairs_trim) <- pair_col
num_pair_data_sum <- count(pairs_trim,pair_col)
num_pair_data_sum <- num_pair_data_sum[order(num_pair_data_sum[,"freq"]),]
row.names(num_pair_data_sum) <- seq(nrow(num_pair_data_sum))
return(num_pair_data_sum)
}
num_pairs_screen_execute <- function(data,ret_col,lag_ret_col){
# data <- x
# ret_col <- analysis_col
# lag_ret_col <- paste(analysis_col,"lag1",sep="_")
num_pair_data <- num_pairs_screen_pairs(data=data,ret_col=ret_col,lag_ret_col=lag_ret_col)
num_pairs_counts <- num_pairs_screen_counts(pairs=num_pair_data,pair_col="Pair")
num_pairs_screen_temp <- data.frame(Max_Pairs=NA,Total=NA,Prop_u=NA, stringsAsFactors=FALSE)
num_pairs_screen_temp[,"Max_Pairs"] <- tail(num_pairs_counts[,"freq"],1)
num_pairs_screen_temp[,"Total"] <- nrow(data)
num_pairs_screen_temp[,"Prop_u"] <- num_pairs_screen_temp[,"Max_Pairs"]/num_pairs_screen_temp[,"Total"]
return(num_pairs_screen_temp)
}
data_s5_4_screen <- ddply(.data=data_s5, .variables=identifier, .fun = function(x,analysis_col,id_col){
# x <- data_s5[data_s5[,identifier]==0,]
# analysis_col <- analysis_col
# id_col <- identifier
num_pairs_screen <- num_pairs_screen_execute(data=x,ret_col=analysis_col,lag_ret_col=paste(analysis_col,"lag1",sep="_"))
return(num_pairs_screen)
}, analysis_col=analysis_col,id_col=identifier, .progress = "text", .inform = FALSE, .drop = TRUE)
View(data_s5_4_screen)
data_s5_4_full <- data.frame(data_s5_4_screen,cutoff=NA,
num_pairs_percent_99=NA,num_pairs_percent_95=NA,num_pairs_percent_90=NA,
stringsAsFactors=FALSE)
rm(data_s5_1_freq)
data_s5_4_full[,"num_pairs_percent_99"] <- ifelse(data_s5_4_full[,"Prop_u"]<=0.01,1,0)
data_s5_4_full[,"num_pairs_percent_95"] <- ifelse(data_s5_4_full[,"Prop_u"]<=0.05,1,0)
data_s5_4_full[,"num_pairs_percent_90"] <- ifelse(data_s5_4_full[,"Prop_u"]<=0.10,1,0)
data_s5_4_final <- data_s5_4_full[,c(identifier,"num_pairs_percent_99","num_pairs_percent_95","num_pairs_percent_90")]
rm2(data_s5_4_full)
